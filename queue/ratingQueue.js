const { Queue } = require("bullmq");
const { connection } = require("./redis");

const ratingQueue = new Queue("ratingQueue", {
  connection,
  //concurrency: 10, // –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–æ 10 –∑–∞–¥–∞—á –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ/ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
  // ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –∑–∞–¥–∞—á –æ—á–µ—Ä–µ–¥–∏
  defaultJobOptions: {
    /**
     * removeOnComplete:
     *  - true ‚Üí –∑–∞–¥–∞—á–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ Redis –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
     *  - false ‚Üí –∑–∞–¥–∞—á–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ Redis (–∑–∞—Ö–ª–∞–º–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º)
     *  - —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1000) ‚Üí —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á,
     *    –æ—Å—Ç–∞–ª—å–Ω—ã–µ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—å—Å—è.
     *
     * üí° –î–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º —Å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏ (–∫–∞–∫ —É —Ç–µ–±—è)
     *     –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ: 1000 ‚Äî –æ—Å—Ç–∞–≤–ª—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 1000 —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–¥–∞—á –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.
     */
    removeOnComplete: 10000,

    /**
     * removeOnFail:
     *  - false ‚Üí –æ—Å—Ç–∞–≤–ª—è—Ç—å —É–ø–∞–≤—à–∏–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
     *  - true ‚Üí —É–¥–∞–ª—è—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ (–ª—É—á—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –ø—Ä–∏—á–∏–Ω—ã –ø–∞–¥–µ–Ω–∏–π)
     */
    removeOnFail: false,

    /**
     * attempts:
     *  –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–¥–∞—á—É –ø—Ä–∏ –æ—à–∏–±–∫–µ, –ø—Ä–µ–∂–¥–µ —á–µ–º –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ "failed".
     *  –ü–æ–ª–µ–∑–Ω–æ, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –±–∞–∑–∞ –∏–ª–∏ Redis –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.
     */
    attempts: 3,

    /**
     * backoff:
     *  –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—É–∑—ã –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏.
     *  "exponential" ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ —Ä–∞—Å—Ç—ë—Ç: 5s ‚Üí 10s ‚Üí 20s –∏ —Ç.–¥.
     */
    backoff: { type: "exponential", delay: 5000 },
  },
});

module.exports = { ratingQueue };
