// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl"]
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model RefreshToken {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  token      String   @unique
  userId     String   @db.ObjectId
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  activeRole String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  deviceInfo String? // –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
  isActive   Boolean  @default(true)

  @@index([userId])
  @@index([expiresAt]) // –î–ª—è –±—ã—Å—Ç—Ä–æ–π –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–æ—Ç—É—Ö—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤
}

model User {
  id              String              @id @default(auto()) @map("_id") @db.ObjectId
  phone           String              @unique
  password        String
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  student         Student?
  tutor           Tutor?
  employee        Employee?
  refreshTokens   RefreshToken[] // –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî –º–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤
  welcomeState    UserWelcomeScreen[]
  deletedRequests DeletedRequest[]    @relation("UserToDeletedRequest")
}

model SmsVerification {
  id               String   @id @default(auto()) @map("_id") @db.ObjectId
  phone            String   @unique
  secretCode       String
  expiresAt        DateTime // –∫–æ–≥–¥–∞ –∫–æ–¥ –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç –±—ã—Ç—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º
  retryAvailableAt DateTime // –∫–æ–≥–¥–∞ –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–¥
  index            Int      @default(0) // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model Student {
  id                        String    @id @default(auto()) @map("_id") @db.ObjectId
  userId                    String    @unique @db.ObjectId
  user                      User      @relation(fields: [userId], references: [id])
  chats                     Chat[]    @relation("StudentChats")
  createdAt                 DateTime  @default(now())
  updatedAt                 DateTime  @updatedAt
  name                      String
  phone                     String    @unique
  email                     String?
  isVerifedEmail            Boolean   @default(false)
  telegram                  String?
  skype                     String?
  region                    String
  avatarUrl                 String?
  isNotifications           Boolean   @default(true) // "–ü–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
  isNotificationsResponse   Boolean   @default(true) // –¥–ª—è "–û—Ç–∫–ª–∏–∫–æ–≤ –æ—Ç —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–≤"
  isNotificationsPromo      Boolean   @default(true)
  isNotificationsSms        Boolean   @default(true)
  isNotificationsEmail      Boolean   @default(true)
  isNotificationsTelegram   Boolean   @default(true)
  isNotificationsMobilePush Boolean   @default(true)
  isNotificationsWebPush    Boolean   @default(true)
  isNotificationsVk         Boolean   @default(true)
  userRating                Float     @default(4.5) // –≤–∏–¥–∏–º—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Ä–µ–π—Ç–∏–Ω–≥, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏
  // publicRating              Float     @default(4.5) // –≤–∏–¥–∏–º—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Ä–µ–π—Ç–∏–Ω–≥, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏
  status                    String
  orders                    Order[]
  reviews                   Review[]  @relation("StudentReviews")
  lastOnline                DateTime? // –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞—Ö–æ–¥–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)
}

model Tutor {
  id                        String              @id @default(auto()) @map("_id") @db.ObjectId
  userId                    String              @unique @db.ObjectId
  user                      User                @relation(fields: [userId], references: [id])
  createdAt                 DateTime            @default(now())
  updatedAt                 DateTime            @updatedAt
  name                      String?
  phone                     String              @unique
  email                     String?
  isVerifedEmail            Boolean             @default(false)
  telegram                  String?
  telegramConnectToken      String?
  telegramId                String?
  skype                     String?
  avatarUrl                 String?
  subject                   String[]            @default([])
  subjectComments           Json                @default("[]")
  region                    String?
  regionSlug                String?
  tutorPlace                String[]            @default([])
  tutorAdress               String?
  tutorHomeLoc              String[]            @default([])
  tutorTrip                 String[]            @default([])
  tutorTripCityData         String?
  tutorTripCity             String[]            @default([])
  tutorTripArea             String[]            @default([])
  profileInfo               String?
  experience                String?
  educations                TutorEducation[]
  documents                 TutorDocument[]
  isGroup                   Boolean             @default(false)
  status                    String
  response                  Response[]
  chats                     Chat[]              @relation("TutorsChats")
  contracts                 Contract[]          @relation("TutorContracts")
  subjectPrices             TutorSubjectPrice[] @relation("TutorToSubjectPrices")
  tutorGoals                TutorGoal[]
  isPublicProfile           Boolean             @default(true) // –¥–ª—è "–ü—É–±–ª–∏—á–Ω–æ–π –∞–Ω–∫–µ—Ç—ã"
  isStudentResponses        Boolean             @default(true) // –¥–ª—è "–ü–æ–ª—É—á–∞—Ç—å –æ—Ç–∫–ª–∏–∫–∏ –æ—Ç —É—á–µ–Ω–∏–∫–æ–≤"
  isNotifications           Boolean             @default(true) // "–ü–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
  isNotificationsOrders     Boolean             @default(true) // –¥–ª—è "–ù–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤"
  isNotificationsResponse   Boolean             @default(true) // –¥–ª—è "–û—Ç–∫–ª–∏–∫–æ–≤ –æ—Ç —É—á–µ–Ω–∏–∫–æ–≤"
  isNotificationsPromo      Boolean             @default(true)
  isNotificationsSms        Boolean             @default(true)
  isNotificationsEmail      Boolean             @default(true)
  isNotificationsTelegram   Boolean             @default(false)
  isNotificationsMobilePush Boolean             @default(true)
  isNotificationsWebPush    Boolean             @default(true)
  isNotificationsVk         Boolean             @default(true)
  badges                    String[]            @default([]) // –°–ø–∏—Å–æ–∫ —à–∏–ª—å–¥–∏–∫–æ–≤
  reviews                   Review[]            @relation("TutorReviews")
  userRating                Float               @default(0) // —Ä–µ–π—Ç–∏–Ω–≥ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—É—á–µ–Ω–∏–∫–æ–≤), —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ü–µ–Ω–æ–∫ –≤ –æ—Ç–∑—ã–≤–∞—Ö
  serviceRating             Float               @default(0) // —Ä–µ–π—Ç–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å–∞, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Å–µ—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤
  totalRating               Float               @default(0) // –æ–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥, –∫–æ–º–±–∏–Ω–∞—Ü–∏—è userRating –∏ serviceRating
  // publicRating              Float               @default(0) // –≤–∏–¥–∏–º—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Ä–µ–π—Ç–∏–Ω–≥, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏
  // internalRating            Float               @default(4.5) // –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥, —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Ñ–∞–∫—Ç–æ—Ä—ã
  // employeesRating           Float               @default(0) // –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
  contractCount             Int                 @default(0) // –∫–æ–ª-–≤–æ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–µ–π
  contractRejectCount       Int                 @default(0) // –∫–æ–ª-–≤–æ –æ—Ç–º–µ–Ω—ã –ø–æ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—è–º
  averagePay                Float               @default(0) // —Å—Ä–µ–¥–Ω–∏–π –ø–ª–∞—Ç–µ–∂
  refundsPayCount           Int                 @default(0) // –∫–æ–ª-–≤–æ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –ø–æ –æ—Ç–∫–ª–∏–∫–∞–º
  reviewsCount              Int                 @default(0) // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤
  averageReviewScore        Float               @default(0) // —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –æ—Ç–∑—ã–≤–æ–≤
  responseTimeSeconds       Int                 @default(0) // —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
  responseCount             Int                 @default(0) // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫–ª–∏–∫–æ–≤
  sessionCount              Int                 @default(0) // –∫–æ–ª-–≤–æ —Å–µ—Å—Å–∏–π
  hasQualityAvatar          Boolean             @default(false)
  hasSubjectPrices          Boolean             @default(false)
  hasPriceComments          Boolean             @default(false)
  hasProfileInfo            Boolean             @default(false)
  hasEducation              Boolean             @default(false)
  hasEducationPhotos        Boolean             @default(false)
  lastOnline                DateTime? // –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞—Ö–æ–¥–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)

  // –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
  @@index([status, isPublicProfile])
}

model TutorSubjectPrice {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  tutorId   String @db.ObjectId
  tutor     Tutor  @relation("TutorToSubjectPrices", fields: [tutorId], references: [id], onDelete: Cascade)
  subjectId String // id –ø—Ä–µ–¥–º–µ—Ç–∞
  format    String // "online" | "home" | "travel" | "group"
  price     Int
  duration  String // "45" | "60" | "90" | "120" | "day"

  @@unique([tutorId, subjectId, format]) // –£–Ω–∏–∫–∞–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è
}

model TutorGoal {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  tutorId   String @db.ObjectId
  subjectId String
  goalId    String @db.ObjectId

  tutor Tutor @relation(fields: [tutorId], references: [id])
  goal  Goal  @relation(fields: [goalId], references: [id])
}

model Goal {
  id            String  @id @default(auto()) @map("_id") @db.ObjectId
  title         String  @unique
  goalSlug      String? @unique
  for_request   String?
  isGoalInOrder Boolean @default(true)
  isTutorFilter Boolean @default(true)

  goalCategories GoalToCategory[]
  tutorGoals     TutorGoal[]
  orders         Order[]          @relation("GoalOrders") // üîë —Å–≤—è–∑—å —Å –∑–∞–∫–∞–∑–∞–º–∏
}

model GoalCategory {
  id             String           @id @default(auto()) @map("_id") @db.ObjectId
  title          String           @unique
  goal_id        String? // —Å–≤—è–∑—å —Å –∏–∑–Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤ –ø—Ä–µ–¥–º–µ—Ç–∞—Ö –ø–æ —Ü–µ–ª—è–º
  subjects       Subject[]
  goalCategories GoalToCategory[]
}

model GoalToCategory {
  id         String @id @default(auto()) @map("_id") @db.ObjectId
  goalId     String @db.ObjectId
  categoryId String @db.ObjectId

  goal     Goal         @relation(fields: [goalId], references: [id])
  category GoalCategory @relation(fields: [categoryId], references: [id])

  @@unique([goalId, categoryId]) // —á—Ç–æ–±—ã –æ–¥–Ω–∞ —Ü–µ–ª—å –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∞—Å—å –≤ –æ–¥–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
}

model TutorEducation {
  id                 String   @id @default(auto()) @map("_id") @db.ObjectId
  tutorId            String   @db.ObjectId
  tutor              Tutor    @relation(fields: [tutorId], references: [id], onDelete: Cascade)
  educationInfo      String // –ù–∞–∑–≤–∞–Ω–∏–µ –≤—É–∑–∞, —Ñ–∞–∫—É–ª—å—Ç–µ—Ç, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  educationStartYear String // –ì–æ–¥ –Ω–∞—á–∞–ª–∞ –æ–±—É—á–µ–Ω–∏—è
  educationEndYear   String? // –ì–æ–¥ –æ–∫–æ–Ω—á–∞–Ω–∏—è –æ–±—É—á–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –µ—â–µ —É—á–∏—Ç—Å—è)
  educationDiplomUrl String[] // –£–†–õ –Ω–∞ —Ñ–æ—Ç–æ –¥–∏–ø–ª–æ–º–∞
  isShowDiplom       Boolean  @default(false) // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–∏ —Ñ–æ—Ç–æ –¥–∏–ø–ª–æ–º–∞ —É—á–µ–Ω–∏–∫–∞–º
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model TutorDocument {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  tutorId     String   @db.ObjectId
  tutor       Tutor    @relation(fields: [tutorId], references: [id], onDelete: Cascade)
  description String? // –û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
  documentUrl String // –£–†–õ –Ω–∞ —Ñ–æ—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
  isShow      Boolean  @default(false) // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–∏ —É—á–µ–Ω–∏–∫–∞–º
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Employee {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @unique @db.ObjectId
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  name      String
  phone     String   @unique
  email     String?  @unique
  region    String?
  role      String
  status    String
}

model Order {
  id                     String     @id @default(auto()) @map("_id") @db.ObjectId
  studentId              String     @db.ObjectId
  student                Student    @relation(fields: [studentId], references: [id], onDelete: Cascade)
  chats                  Chat[]     @relation("Chats")
  response               Response[]
  createdAt              DateTime   @default(now())
  updatedAt              DateTime   @updatedAt
  publishedAt            DateTime? // –î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∑–∞–∫–∞–∑–∞
  subject                String
  goal                   String?
  goalId                 String?    @db.ObjectId
  goalRef                Goal?      @relation("GoalOrders", fields: [goalId], references: [id])
  studentType            String?
  studentYears           String?
  studentClass           String?
  studentCourse          String?
  studentUniversity      String?
  studentExam            String?
  studyMethod            String?
  studyProgramm          String?
  deadline               String?
  studentLevel           String?
  tutorGender            String?
  studentSchedule        String?
  studentPlace           String[]
  region                 String
  studentAdress          String?
  studentTrip            String[]   @default([])
  studentHomeLoc         String[]   @default([])
  tutorType              String?
  autoContactsOnResponse Boolean?
  studentWishes          String?
  responseCost           String?
  contracts              Contract[] @relation("OrderContracts")
  reviews                Review[]   @relation("OrderReviews")
  status                 String

  // @@index([createdAt])
  // @@index([subject])
  // @@index([publishedAt])
}

model Contract {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  orderId String @db.ObjectId
  order   Order  @relation("OrderContracts", fields: [orderId], references: [id], onDelete: Cascade)

  tutorId String @db.ObjectId
  tutor   Tutor  @relation("TutorContracts", fields: [tutorId], references: [id], onDelete: Cascade)

  selectedBy String // "student" | "tutor"
  comments   Comment[] @relation("ContractComments")
  selectedAt DateTime  @default(now())
  canceledAt DateTime?
}

model Response {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  tutorId   String   @db.ObjectId
  tutor     Tutor    @relation(fields: [tutorId], references: [id])
  orderId   String   @db.ObjectId
  order     Order    @relation(fields: [orderId], references: [id])
  text      String
  createdAt DateTime @default(now())
}

model WelcomeScreen {
  id                 String              @id @default(auto()) @map("_id") @db.ObjectId
  title              String
  content            String
  link               String?
  userType           String // –î–ª—è –∫–∞–∫–æ–≥–æ —Ç–∏–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —ç—Ç–æ—Ç —Å–∫—Ä–∏–Ω
  page               String // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –£–∫–∞–∑—ã–≤–∞–µ—Ç, –¥–ª—è –∫–∞–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω —ç–∫—Ä–∞–Ω
  group              String // –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–Ω–æ–≤ –≤ –≥—Ä—É–ø–ø—ã
  order              Int // –ü–æ—Ä—è–¥–æ–∫ –ø–æ–∫–∞–∑–∞ —ç–∫—Ä–∞–Ω–æ–≤
  isActive           Boolean             @default(false) // –ö–æ–Ω—Ç—Ä–æ–ª—å –ø–æ–∫–∞–∑–∞ —ç–∫—Ä–∞–Ω–∞
  userWelcomeScreens UserWelcomeScreen[] // –≠—Ç–æ –ø–æ–ª–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –≤ UserWelcomeScreen
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
}

model UserWelcomeScreen {
  id            String        @id @default(auto()) @map("_id") @db.ObjectId
  userId        String        @db.ObjectId
  welcomeId     String        @db.ObjectId
  viewedAt      DateTime      @default(now()) // –í—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —ç–∫—Ä–∞–Ω–∞
  user          User          @relation(fields: [userId], references: [id])
  welcomeScreen WelcomeScreen @relation(fields: [welcomeId], references: [id])

  @@unique([userId, welcomeId]) // –£–Ω–∏–∫–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ —ç–∫—Ä–∞–Ω–æ–º
  @@index([userId]) // –ò–Ω–¥–µ–∫—Å –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –≤—ã–±–æ—Ä–∫–∏ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  @@index([welcomeId]) // –ò–Ω–¥–µ–∫—Å –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –≤—ã–±–æ—Ä–∫–∏ –ø–æ —ç–∫—Ä–∞–Ω—É
}

model City {
  id                 String         @id @default(auto()) @map("_id") @db.ObjectId
  title              String         @unique
  area               String
  shortTitle         String
  region_name_dative String? // –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–∞ –≤ –¥–∞—Ç–µ–ª—å–Ω–æ–º –ø–∞–¥–∞–∂–µ –¥–ª—è –º–µ—Ç–∞-—Ç–µ–≥–æ–≤
  slug               String?        @unique
  metros             Metro[]
  districts          District[]
  regionalCities     RegionalCity[]
}

model District {
  id     String  @id @default(auto()) @map("_id") @db.ObjectId
  title  String
  type   String? // "District", "Area", "Microdistrict" –∏ —Ç.–ø.
  cityId String  @db.ObjectId
  city   City    @relation(fields: [cityId], references: [id])
}

model Metro {
  id         String  @id @default(auto()) @map("_id") @db.ObjectId
  title      String
  color      String?
  lineName   String?
  lineNumber String?
  cityPrefix String?
  cityId     String  @db.ObjectId
  city       City    @relation(fields: [cityId], references: [id])
}

model RegionalCity {
  id     String  @id @default(auto()) @map("_id") @db.ObjectId
  title  String
  type   String?
  cityId String  @db.ObjectId
  city   City    @relation(fields: [cityId], references: [id])
}

model Topic {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  title          String
  description    String
  order          Int
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  visibleToRoles String[]
  themes         Theme[]
}

model Theme {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  topicId        String   @db.ObjectId // –°—Å—ã–ª–∫–∞ –Ω–∞ `Topic`
  title          String
  content        String
  order          Int
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  topic          Topic    @relation(fields: [topicId], references: [id], onDelete: Cascade)
  visibleToRoles String[]
}

model DeletedRequest {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String?  @db.ObjectId
  user        User?    @relation(fields: [userId], references: [id], onDelete: SetNull, name: "UserToDeletedRequest")
  role        String // "tutor" –∏–ª–∏ "student"
  requestedAt DateTime @default(now())
  expiresAt   DateTime // –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
  answer      String?

  @@unique([userId, role]) // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —É –æ–¥–Ω–æ–≥–æ —é–∑–µ—Ä–∞ –Ω–µ –±—É–¥–µ—Ç –¥–≤—É—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –æ–¥–Ω—É —Ä–æ–ª—å
}

model Chat {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  studentId      String?   @db.ObjectId
  student        Student?  @relation("StudentChats", fields: [studentId], references: [id], onDelete: SetNull)
  tutorId        String?   @db.ObjectId
  tutor          Tutor?    @relation("TutorsChats", fields: [tutorId], references: [id], onDelete: SetNull)
  orderId        String    @db.ObjectId
  order          Order     @relation("Chats", fields: [orderId], references: [id])
  messages       Message[] @relation("ChatMessages")
  tutorHasAccess Boolean   @default(false)
  themeOrder     String?
  initiatorRole  String?
  status         String?
  createdAt      DateTime  @default(now())
}

model Message {
  id       String @id @default(auto()) @map("_id") @db.ObjectId
  chatId   String @db.ObjectId
  chat     Chat   @relation("ChatMessages", fields: [chatId], references: [id], onDelete: Cascade)
  senderId String @db.ObjectId
  text     String

  type          String? @default("user") // "user" –∏–ª–∏ "service"
  recipientRole String? // null ‚Äî –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–∞—Ç–∞, –∏–ª–∏ "student" | "tutor" | "admin" –∏ —Ç.–ø.

  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
}

model Subject {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  title       String  @unique
  for_request String
  for_chpu    String  @unique
  id_cat      String
  general     Boolean
  nextPage    String
  id_p        String  @unique
  goal_id     String // –Ω–∞–¥–æ –±—É–¥–µ—Ç —É–¥–∞–ª–∏—Ç—å

  // —Å–≤—è–∑—å —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π —Ü–µ–ª–µ–π
  goalCategoryId String?       @db.ObjectId
  goalCategory   GoalCategory? @relation(fields: [goalCategoryId], references: [id])
}

model Comment {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  contractId String?   @db.ObjectId
  contract   Contract? @relation("ContractComments", fields: [contractId], references: [id], onDelete: Cascade)
  reviewId   String?   @db.ObjectId
  review     Review?   @relation("ReviewComments", fields: [reviewId], references: [id], onDelete: Cascade)

  senderId   String   @db.ObjectId
  senderRole String // "student" | "tutor" | "admin"
  text       String
  createdAt  DateTime @default(now())
}

model Review {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  orderId String? @db.ObjectId
  order   Order?  @relation("OrderReviews", fields: [orderId], references: [id])

  tutorId String @db.ObjectId
  tutor   Tutor  @relation("TutorReviews", fields: [tutorId], references: [id], onDelete: Cascade)

  studentId String?  @db.ObjectId
  student   Student? @relation("StudentReviews", fields: [studentId], references: [id])

  name       String?
  authorRole String // "student" | "tutor"
  message    String?
  rating     Int
  status     String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  comments Comment[] @relation("ReviewComments")
}
